name: CI - Test sito

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - uses: actions/checkout@v4
      - name: Install gcc on Windows
        if: matrix.os == 'windows-latest'
        run: choco install mingw -y
      - name: Build Test sito
        run: |
          cd "Test sito"
          gcc -g Sartoria.c -o Sartoria || exit 1
      - name: Run selftest
        run: |
          cd "Test sito"
          if [ "${{ matrix.os }}" = "windows-latest" ]; then
            Sartoria.exe --selftest
          else
            ./Sartoria --selftest
          fi
